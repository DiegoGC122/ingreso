# verificacion.py

import random
import smtplib
from email.mime.text import MIMEText
from config import REMITENTE, PASSWORD, SMTP_SERVIDOR, SMTP_PUERTO

def generar_codigo_temporal():
    return str(random.randint(100000, 999999))

def enviar_codigo_desde_gmail(correo_destino, codigo):
    asunto = "üîê C√≥digo de verificaci√≥n BBVA"
    cuerpo = f"""
Hola,

Tu c√≥digo de acceso es: {codigo}

Este c√≥digo es v√°lido por 2 minutos. No compartas este mensaje.

Atentamente,
Sistema de Registro BBVA
"""

    msg = MIMEText(cuerpo)
    msg['Subject'] = asunto
    msg['From'] = REMITENTE
    msg['To'] = correo_destino

    try:
        with smtplib.SMTP(SMTP_SERVIDOR, SMTP_PUERTO) as server:
            server.starttls()
            server.login(REMITENTE, PASSWORD)
            server.sendmail(REMITENTE, [correo_destino], msg.as_string())
        return True
    except Exception as e:
        import traceback
        print("‚ùå Error al enviar el c√≥digo:", repr(e))
        traceback.print_exc()
        return False
